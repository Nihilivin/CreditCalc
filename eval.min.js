"use strict";function Calculator(){var t,e,a,n;Object.defineProperties(this,{amount:{get:function(){return t},set:function(e){e=parseFloat(e),isFinite(e)&&e>0&&(t=e)}},rate:{get:function(){return a},set:function(t){t=parseFloat(t),isFinite(t)&&t>0&&(a=t)}},duration:{get:function(){return e},set:function(t){t=parseFloat(t),isFinite(t)&&t>0&&(e=t)}},payment:{get:function(){return n},set:function(t){t=parseFloat(t),isFinite(t)&&t>0&&(n=t)}}})}function attach(t,e,a){function n(t,e,a){t&&e&&a&&(t.addEventListener?t.addEventListener(e,a):t.attachEvent(e,a))}null!=t&&"undefined"!=typeof t&&"Array"==t.constructor.name||(t=[t]),null!=e&&"undefined"!=typeof e&&"Array"==e.constructor.name||(e=[e]),null!=a&&"undefined"!=typeof a&&"Array"==a.constructor.name||(a=[a]);var l=0,r=0,u=0,o=t.length,i=e.length,s=a.length;for(l=0;o>l;l++)for(r=0;i>r;r++)for(u=0;s>u;u++)n(t[l],e[r],a[u])}function detach(t,e,a){function n(t,e,a){t&&e&&a&&(t.removeEventListener?t.removeEventListener(e,a):t.detachEvent(e,a))}null!=t&&"undefined"!=typeof t&&"Array"==t.constructor.name||(t=[t]),null!=e&&"undefined"!=typeof e&&"Array"==e.constructor.name||(e=[e]),null!=a&&"undefined"!=typeof a&&"Array"==a.constructor.name||(a=[a]);var l=0,r=0,u=0,o=t.length,i=e.length,s=a.length;for(l=0;o>l;l++)for(r=0;i>r;r++)for(u=0;s>u;u++)n(t[l],e[r],a[u])}function gei(t){return document.getElementById(t)}function setButtonsToDefaultColor(){}function enableCalcButtons(){for(var t in formElems)formElems[t].calc.disabled=3!=Object.keys(formElems).filter(function(e){return e!=t&&isParsableNumber(formElems[e].value.value)}).length}function isParsableNumber(t){return t.length>0?!(t.match(/[^0-9,. ]/)||(t.match(/[.,]/g)||[]).length>1||!t.match(/^\d/)||!t.match(/\d$/)):!1}function setButtonsToDefaultColor(){}function getValue(t){return formElems[t]&&formElems[t].value?(formElems[t].value.classList.remove("calculated"),formElems[t].value.value):null}function setAmount(t){rateVal=getRate(),durationVal=getDuration(),paymentVal=getPayment(),0!=rateVal&&0!=durationVal&&0!=paymentVal&&(amountValue.value=computeAmount(rateVal,paymentVal,durationVal),setButtonsToDefaultColor()),1!=t&&setOtherFields("amount-value")}function setDuration(t){rateVal=getRate(),amountVal=getAmount(),paymentVal=getPayment(),0!=rateVal&&0!=amountVal&&0!=paymentVal&&(durationValue.value=computeDuration(rateVal,amountVal,paymentVal),setButtonsToDefaultColor()),1!=t&&setOtherFields("duration-value")}function setRate(t){amountVal=getAmount(),durationVal=getDuration(),paymentVal=getPayment(),0!=amountVal&&0!=durationVal&&0!=paymentVal&&(rateValue.value=computeRate(paymentVal,amountVal,durationVal),setButtonsToDefaultColor()),1!=t&&setOtherFields("rate-value")}function setPayment(t){rateVal=getRate(),durationVal=getDuration(),amountVal=getAmount(),0!=rateVal&&0!=durationVal&&0!=amountVal&&(paymentValue.value=computePayment(rateVal,amountVal,durationVal),setButtonsToDefaultColor()),1!=t&&setOtherFields("payment-value")}Calculator.prototype={calc_amount:function(){var t=-this.duration,e=this.rate/12;return this.payment*(1-Math.pow(1+e,t))/e},calc_duration:function(){var t=this.rate/12;return Math.ceil((Math.log(this.payment)-Math.log(this.payment-this.amount*t))/Math.log(1+t))},calc_rate:function(){if(this.payment*this.duration<this.amount)return 0;var t=1;for(i=0;400>i;i++)t=(this.payment-this.payment/Math.pow(1+t,this.duration))/this.amount;return 12*t},calc_payment:function(){var t=this.rate/1200;return this.amount*t/(1-1/Math.pow(1+t,12*this.duration))}};var calculator=new Calculator,formElems={},arr=["amount","duration","rate","payment"];for(var i in arr){var j=arr[i];formElems[j]={calc:gei(j+"-button"),value:gei(j+"-value"),minus:gei(j+"-minus"),plus:gei(j+"-plus")},formElems[j].value.setAttribute("data-placeholder",formElems[j].value.placeholder),attach(formElems[j].calc,"click",function(){var t=arr.filter(function(t){return t!=j}),e=j;return function(){for(var a in t)calculator[t[a]]=getValue(t[a]);console.log(calculator);var n=calculator["calc_"+e](),l=formElems[e].value;l.value=n,l.classList.add("calculated"),enableCalcButtons()}}()),attach([formElems[j].plus,formElems[j].minus],"click",function(){var t=(formElems[j].value,j);return function(e){var a;a=e.target.id==t+"-plus"?1:e.target.id==t+"-minus"?-1:0,console.log("Factor:",a)}}()),attach(formElems[j].value,"focus",function(){this.setCustomValidity(""),this.placeholder="",this.classList.remove("calculated")}),attach(formElems[j].value,["blur","keyup","change","input"],function(){var t=this,e=t.value.trim();t.placeholder=t.getAttribute("data-placeholder"),!isParsableNumber(e)&&e.length>0?t.setCustomValidity("Cette valeur n'est pas une valeur num√©rique acceptable"):t.setCustomValidity(""),enableCalcButtons()}),attach(formElems[j].value,"blur",function(){var t="duration-value"==this.id?1:100;isParsableNumber(this.value)&&(this.value=parseInt(this.value*t)/t)})}enableCalcButtons(),console.log(formElems);