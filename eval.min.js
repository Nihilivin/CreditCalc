/**
 * @file Main calculator client-side script
 *
 * @author Alexandre Germain
 * @copyright 2016 GerkinDevelopment
 * @license none none
 * @package creditcalc
 *
 * @version 0.1.0
 */
"use strict";function Calculator(){var t,e,a,r;Object.defineProperties(this,{amount:{get:function(){return t},set:function(e){e=parseFloat(e),isFinite(e)&&e>0&&(t=e)}},rate:{get:function(){return a},set:function(t){t=parseFloat(t),isFinite(t)&&t>0&&(a=t)}},duration:{get:function(){return e},set:function(t){t=parseFloat(t),isFinite(t)&&t>0&&(e=t)}},payment:{get:function(){return r},set:function(t){t=parseFloat(t),isFinite(t)&&t>0&&(r=t)}}})}function attach(t,e,a){function r(t,e,a){t&&e&&a&&(t.addEventListener?t.addEventListener(e,a):t.attachEvent(e,a))}null!=t&&"undefined"!=typeof t&&"Array"==t.constructor.name||(t=[t]),null!=e&&"undefined"!=typeof e&&"Array"==e.constructor.name||(e=[e]),null!=a&&"undefined"!=typeof a&&"Array"==a.constructor.name||(a=[a]);var n=0,l=0,u=0,o=t.length,c=e.length,i=a.length;for(n=0;o>n;n++)for(l=0;c>l;l++)for(u=0;i>u;u++)r(t[n],e[l],a[u])}function detach(t,e,a){function r(t,e,a){t&&e&&a&&(t.removeEventListener?t.removeEventListener(e,a):t.detachEvent(e,a))}null!=t&&"undefined"!=typeof t&&"Array"==t.constructor.name||(t=[t]),null!=e&&"undefined"!=typeof e&&"Array"==e.constructor.name||(e=[e]),null!=a&&"undefined"!=typeof a&&"Array"==a.constructor.name||(a=[a]);var n=0,l=0,u=0,o=t.length,c=e.length,i=a.length;for(n=0;o>n;n++)for(l=0;c>l;l++)for(u=0;i>u;u++)r(t[n],e[l],a[u])}function gei(t){return document.getElementById(t)}Calculator.prototype={calc_amount:function(){var t=this,e=t.rate/1200;return t.payment*((1-1/Math.pow(1+e,12*t.duration))/e)},calc_duration:function(){var t=this,e=t.rate/1200;return Math.log(-t.payment/(e*t.amount-t.payment))/(12*Math.log(e+1))},calc_rate:function(){var t,e=this,a=new Calculator,r=0,n=1,l=0;if(e.payment*(12*e.duration)<e.amount)return 0;for(a.duration=e.duration,a.payment=e.payment;n>1e-4&&999>=l;){l++,t=r,r+=n,a.rate=r;var u=a.calc_amount();u<e.amount?(n/=10,r=t):u==e.amout&&(l=1e3)}return r},calc_payment:function(){var t=this,e=t.rate/1200;return t.amount*e/(1-1/Math.pow(1+e,12*t.duration))}};var calculator=new Calculator,formElems={},calculatorVariables={amount:0,duration:1,rate:2,payment:3};calculatorVariables=Object.keys(calculatorVariables),function(){function t(t,e){return e=l(e),-1!=["amount","payment","rate"].indexOf(t)?(parseFloat(Math.ceil(100*e).toFixed(0))/100).toFixed(2):"duration"==t?Math.floor(e).toFixed(0):void 0}function e(t){t+="";for(var e=t.match(/^(\d*)(?:[.,](\d*))?$/),a=/(.*\d)(\d{3})/;e[1].match(a);)e[1]=e[1].replace(a,"$1 $2");var r=e[1];if("undefined"!=typeof e[2]){var n=/(\d{3})(.*\d)/;for(r+=",";e[2].match(n);)e[2]=e[2].replace(n,"$1 $2");r+=e[2]}return r}function a(){for(var t in formElems)formElems[t].calc.disabled=3!=Object.keys(formElems).filter(function(e){return e!=t&&r(formElems[e].value.value)}).length;gei("pager-button-1_2").disabled=4!=Object.keys(formElems).filter(function(t){return r(formElems[t].value.value)}).length}function r(t){return t.length>0?!(t.match(/[^0-9,. ]/)||(t.match(/[.,]/g)||[]).length>1||!t.match(/^\d/)||!t.match(/\d$/)):!1}function n(t){return formElems[t]&&formElems[t].value?(formElems[t].value.classList.remove("calculated"),l(formElems[t].value.value)):0}function l(t){return parseFloat((t+"").replace(/ /g,"").replace(/,/g,".")||0)}for(var u in calculatorVariables)!function(){var o=calculatorVariables[u];formElems[o]={calc:gei(o+"-button"),value:gei(o+"-value"),minus:gei(o+"-minus"),plus:gei(o+"-plus")},formElems[o].value.setAttribute("data-placeholder",formElems[o].value.placeholder),attach(formElems[o].calc,"click",function(){var r=calculatorVariables.filter(function(t){return t!=o}),l=o;return function(){for(var u in r)calculator[r[u]]=n(r[u]);console.log(calculator);var o=calculator["calc_"+l](),c=formElems[l].value;console.log(o),c.value=e(t(l,o)),c.classList.add("calculated"),a()}}()),attach([formElems[o].plus,formElems[o].minus],"click",function(){var a=formElems[o].value,r=o;return function(n){var u;u=n.target.id==r+"-plus"?1:n.target.id==r+"-minus"?-1:0;var o,c;switch(r){case"duration":o=1,c=[0,+(1/0)];break;case"amount":case"payment":for(var i=1,s=l(a.value);s>100-u;i*=10,s/=10);o=i,c=[0,+(1/0)];break;case"rate":o=.1,c=[1,10]}a.value=e(Math.max(c[0],Math.min(c[1],t(r,l(a.value)+o*u))))}}()),attach(formElems[o].value,"focus",function(){this.setCustomValidity(""),this.placeholder="",this.classList.remove("calculated")}),attach(formElems[o].value,["blur","keyup","change","input"],function(){var t=this,e=t.value.trim();!r(e)&&e.length>0?t.setCustomValidity("Cette valeur n'est pas une valeur numérique acceptable"):t.setCustomValidity(""),a()}),attach(formElems[o].value,"blur",function(){var a=this;a.placeholder=a.getAttribute("data-placeholder"),r(a.value)?a.value=e(t(o,a.value)):""==a.value?a.setCustomValidity(""):a.setCustomValidity("Cette valeur n'est pas une valeur numérique acceptable")})}();a(),attach([].slice.call(document.querySelectorAll(".pager-button")),"click",function(){var t=document.querySelector("body");return function(){t.setAttribute("data-page",this.getAttribute("data-page-target"))}}())}();